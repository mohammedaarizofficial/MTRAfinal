@page
@model LandTransportModel
@using MTRADashboard.Models
@{
    ViewData["Title"] = "Material Transport Request";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Material Transport System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <style>
        .section-header {
            background: linear-gradient(135deg, #4285f4 0%, #5f7de2 100%);
            color: white;
            margin-bottom: 0;
            border-radius: 0.375rem 0.375rem 0 0;
        }
        .form-section {
            margin-bottom: 3rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border-radius: 0.375rem;
        }
        .form-section .card-body {
            padding: 2rem;
        }
        .section-divider {
            margin: 3rem 0;
            border: 0;
            height: 2px;
            background: linear-gradient(to right, transparent, #667eea, transparent);
        }
        .required-field::after {
            content: "*";
            color: #dc3545;
            margin-left: 4px;
        }
        .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 0.5rem;
        }
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 0.75rem 2rem;
            font-weight: 500;
            border-radius: 0.375rem;
        }
        .btn-submit:hover {
            transform: translateY(-1px);
            box-shadow: 0 0.25rem 0.5rem rgba(102, 126, 234, 0.3);
        }
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .table-input {
            width: 100%;
            border: none;
            background: transparent;
        }
        .table-input:focus {
            outline: none;
            box-shadow: none;
            border-bottom: 1px solid #667eea;
        }
    </style>
</head>
<body>
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-1 pb-1 mb-3">
        <h1 class="text-center w-100">
            <span class="fw-bold display-4" style="color: #4285f4;">MTRA</span>
            <br>
            <small class="text-muted fs-6">MATERIAL TRANSPORT REQUEST SYSTEM</small>
            <hr class="w-25 mx-auto" style="color: #4285f4; height: 3px;">
        </h1>
    </div>

    <div class="container">
        <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
            <!-- Section 1: Employee & Request Details -->
            <div class="form-section">
                <div class="card">
                    <div class="card-header section-header">
                        <h3 class="mb-0 py-2">
                            <i class="fas fa-clipboard-list me-2"></i>
                            Section 1: Employee & Request Details
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Employee Name</label>
                                <input asp-for="TransportRequest.EmpName" class="form-control" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Designation</label>
                                <input asp-for="TransportRequest.Designation" class="form-control" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Department</label>
                                <input asp-for="TransportRequest.Department" class="form-control" required />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Contact Number</label>
                                <input asp-for="TransportRequest.ContactNumber" class="form-control" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Email</label>
                                <input asp-for="TransportRequest.Email" class="form-control" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">PO/SWO No</label>
                                <input asp-for="TransportRequest.PO_SWO_NO" class="form-control" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Request Date</label>
                                <input asp-for="TransportRequest.RequestDate" type="date" class="form-control" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Request Type</label>
                                <input asp-for="TransportRequest.RequestType" class="form-control" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Priority</label>
                                <input asp-for="TransportRequest.Priority" class="form-control" required />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Site</label>
                                <input asp-for="TransportRequest.Site" class="form-control" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Division</label>
                                <input asp-for="TransportRequest.Division" class="form-control" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Process Type</label>
                                <input asp-for="TransportRequest.ProcessType" class="form-control" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">BackLoad</label>
                                <input asp-for="TransportRequest.BackLoad" type="checkbox" class="form-check-input" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">From Site</label>
                                <input asp-for="TransportRequest.FromSite" class="form-control" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Required Date</label>
                                <input asp-for="TransportRequest.RequiredDate" type="date" class="form-control" required />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Divider -->
            <hr class="section-divider" />

            <!-- Section 2: Assets Form -->
            <div class="form-section">
                <div class="card">
                    <div class="card-header section-header d-flex justify-content-between align-items-center">
                        <h3 class="mb-0 py-2">
                            <i class="fas fa-boxes me-2"></i>
                            Section 2: Asset Details
                        </h3>
                        <button type="button" class="btn btn-light btn-sm" onclick="addAssetCard()">
                            <i class="fas fa-plus"></i> Add Asset
                        </button>
                    </div>
                    <div class="card-body" id="assetsContainer">
                        <!-- Asset cards will be dynamically added here -->
                    </div>
                </div>
            </div>

            <!-- Section Divider -->
            <hr class="section-divider" />

            <!-- Section 3: Materials Form -->
            <div class="form-section">
                <div class="card">
                    <div class="card-header section-header d-flex justify-content-between align-items-center">
                        <h3 class="mb-0 py-2">
                            <i class="fas fa-cubes me-2"></i>
                            Section 3: Material Details
                        </h3>
                        <button type="button" class="btn btn-light btn-sm" onclick="addMaterialCard()">
                            <i class="fas fa-plus"></i> Add Material
                        </button>
                    </div>
                    <div class="card-body" id="materialsContainer">
                        <!-- Material cards will be dynamically added here -->
                    </div>
                </div>
            </div>

            <!-- Section Divider -->
            <hr class="section-divider" />

            <!-- Section 4: Agreement, Accounting, Delivery -->
            <div class="form-section">
                <div class="card">
                    <div class="card-header section-header">
                        <h3 class="mb-0 py-2">
                            <i class="fas fa-file-contract me-2"></i>
                            Section 4: Agreement, Accounting, Delivery
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Agreement No</label>
                                <input asp-for="TransportRequest.AgreementNo" class="form-control" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Agreement Remarks</label>
                                <input asp-for="TransportRequest.AgreementRemarks" class="form-control" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">GL Account Code</label>
                                <input asp-for="TransportRequest.GLAccountCode" class="form-control" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">WBS Code</label>
                                <input asp-for="TransportRequest.WBSCode" class="form-control" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Cost Center</label>
                                <input asp-for="TransportRequest.CostCenter" class="form-control" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Account Remarks</label>
                                <input asp-for="TransportRequest.AccountRemarks" class="form-control" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Loading Address</label>
                                <textarea asp-for="TransportRequest.LoadingAddress" class="form-control" required></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Delivery Address</label>
                                <textarea asp-for="TransportRequest.DeliveryAddress" class="form-control" required></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Contact Name</label>
                                <input asp-for="TransportRequest.ContactName" class="form-control" required />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Contact Email</label>
                                <input asp-for="TransportRequest.ContactEmail" class="form-control" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required-field">Contact Mobile</label>
                                <input asp-for="TransportRequest.ContactMob" class="form-control" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Site Map File</label>
                                <input asp-for="TransportRequest.SiteMapFile" type="file" class="form-control" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="row">
                <div class="col-12 text-center">
                    <button type="submit" class="btn btn-primary btn-submit btn-lg mb-3" style="background: linear-gradient(135deg, #4285f4 0%, #5f7de2 100%);">
                        <i class="fas fa-paper-plane me-2"></i>
                        Submit Transport Request
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        // Dynamic Asset Cards
        function assetCardHtml(idx, showRemove) {
            return `
            <div class="d-flex align-items-end gap-2 mb-3 asset-card">
                <div class="flex-fill">
                    <label class="form-label required-field mb-1">Functional Location</label>
                    <input name="Assets[${idx}].FunctionalLoc" class="form-control" required />
                </div>
                <div class="flex-fill">
                    <label class="form-label required-field mb-1">Equipment No</label>
                    <input name="Assets[${idx}].EquipmentNo" class="form-control" required />
                </div>
                <div class="flex-fill">
                    <label class="form-label required-field mb-1">Asset Value</label>
                    <input name="Assets[${idx}].AssetValue" type="number" step="0.01" min="0" class="form-control" required />
                </div>
                <div class="flex-fill">
                    <label class="form-label mb-1">Asset Description</label>
                    <input name="Assets[${idx}].AssetDesc" class="form-control" />
                </div>
                <div class="flex-fill">
                    <label class="form-label mb-1">Asset Remarks</label>
                    <input name="Assets[${idx}].AssetRemarks" class="form-control" />
                </div>
                ${showRemove ? `<button type="button" class="btn btn-danger btn-sm ms-2 mb-2" onclick="removeAssetCard(this)"><i class="fas fa-trash"></i></button>` : ''}
            </div>`;
        }
        function addAssetCard() {
            var container = document.getElementById('assetsContainer');
            var idx = container.querySelectorAll('.asset-card').length;
            var showRemove = idx > 0;
            container.insertAdjacentHTML('beforeend', assetCardHtml(idx, showRemove));
            updateAssetRemoveButtons();
        }
        function removeAssetCard(btn) {
            var card = btn.closest('.asset-card');
            card.parentNode.removeChild(card);
            // Re-index names
            var cards = document.querySelectorAll('.asset-card');
            cards.forEach(function(card, i) {
                card.querySelectorAll('input').forEach(function(input) {
                    input.name = input.name.replace(/Assets\[\d+\]/, `Assets[${i}]`);
                });
            });
            updateAssetRemoveButtons();
        }
        function updateAssetRemoveButtons() {
            var cards = document.querySelectorAll('.asset-card');
            cards.forEach(function(card, i) {
                var btn = card.querySelector('button.btn-danger');
                if (btn) btn.style.display = i === 0 ? 'none' : '';
            });
        }
        // Dynamic Material Cards
        function materialCardHtml(idx, showRemove) {
            return `
            <div class="d-flex align-items-end gap-2 mb-3 material-card">
                <div class="flex-fill">
                    <label class="form-label required-field mb-1">Material Description</label>
                    <input name="Materials[${idx}].MaterialDesc" class="form-control" required />
                </div>
                <div class="flex-fill">
                    <label class="form-label required-field mb-1">Material Value</label>
                    <input name="Materials[${idx}].MaterialValue" type="number" step="0.01" min="0" class="form-control" required />
                </div>
                <div class="flex-fill">
                    <label class="form-label required-field mb-1">Material Code</label>
                    <input name="Materials[${idx}].MaterialCode" class="form-control" required />
                </div>
                <div class="flex-fill">
                    <label class="form-label mb-1">WPS Code</label>
                    <input name="Materials[${idx}].WPSCode" class="form-control" />
                </div>
                ${showRemove ? `<button type="button" class="btn btn-danger btn-sm ms-2 mb-2" onclick="removeMaterialCard(this)"><i class="fas fa-trash"></i></button>` : ''}
            </div>`;
        }
        function addMaterialCard() {
            var container = document.getElementById('materialsContainer');
            var idx = container.querySelectorAll('.material-card').length;
            var showRemove = idx > 0;
            container.insertAdjacentHTML('beforeend', materialCardHtml(idx, showRemove));
            updateMaterialRemoveButtons();
        }
        function removeMaterialCard(btn) {
            var card = btn.closest('.material-card');
            card.parentNode.removeChild(card);
            // Re-index names
            var cards = document.querySelectorAll('.material-card');
            cards.forEach(function(card, i) {
                card.querySelectorAll('input').forEach(function(input) {
                    input.name = input.name.replace(/Materials\[\d+\]/, `Materials[${i}]`);
                });
            });
            updateMaterialRemoveButtons();
        }
        function updateMaterialRemoveButtons() {
            var cards = document.querySelectorAll('.material-card');
            cards.forEach(function(card, i) {
                var btn = card.querySelector('button.btn-danger');
                if (btn) btn.style.display = i === 0 ? 'none' : '';
            });
        }
        // Add default card for assets and materials on page load
        window.onload = function() {
            var assetContainer = document.getElementById('assetsContainer');
            if (assetContainer.querySelectorAll('.asset-card').length === 0) {
                addAssetCard();
            }
            var materialContainer = document.getElementById('materialsContainer');
            if (materialContainer.querySelectorAll('.material-card').length === 0) {
                addMaterialCard();
            }
        };
    </script>
    <!-- Form Validation Script -->
    <script>
        // Bootstrap form validation
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
</body>
</html>